# picoGym Level 456: Event-Viewing
Source: https://play.picoctf.org/practice/challenge/456

## Goal
One of the employees at your company has their computer infected by malware! Turns out every time they try to switch on the computer, it shuts down right after they log in. The story given by the employee is as follows:<br>
1. They installed software using an installer they downloaded online
2. They ran the installed software but it seemed to do nothing
3. Now every time they bootup and login to their computer, a black command prompt screen quickly opens and closes and their computer shuts down instantly.

See if you can find evidence for the each of these events and retrieve the flag (split into 3 pieces) from the correct logs!<br>
Download the Windows Log file here<br>
https://challenge-files.picoctf.net/c_verbal_sleep/123d9b79cadb6b44ab6ae912f25bf9cc18498e8addee851e7d349416c7ffc1e1/Windows_Logs.evtx

## What I learned
```
.evtx extension ‚Üí Native format used by Windows Event Viewer to store logs.

Contents ‚Üí It records system, application, security, and other event messages generated by Windows and applications. These events include things like login attempts, service starts/stops, application crashes, warnings, and errors.

Purpose ‚Üí Used for troubleshooting, auditing, and forensic analysis.

Where it comes from ‚Üí Normally located in C:\Windows\System32\winevt\Logs\ with names like System.evtx, Application.evtx, Security.evtx

How to open it
On Windows:
    Press Win+R, type eventvwr.msc, hit Enter.
    In Event Viewer, go to Action ‚Üí Open Saved Log..., then select the .evtx file.
On Linux/macOS:
    You can use forensic tools like evtx_dump.py (from Willi Ballenthin‚Äôs python-evtx) or pyevtx.
```

## Solution
```
https://webshell.picoctf.org/

AsianHacker-picoctf@webshell:~$ wget https://challenge-files.picoctf.net/c_verbal_sleep/ 123d9b79cadb6b44ab6ae912f25bf9cc18498e8addee851e7d349416c7ffc1e1/Windows_Logs.evtx ‚å®Ô∏è
--2025-09-22 22:12:55--  https://challenge-files.picoctf.net/c_verbal_sleep/123d9b79cadb6b44ab6ae912f25bf9cc18498e8addee851e7d349416c7ffc1e1/Windows_Logs.evtx
Resolving challenge-files.picoctf.net (challenge-files.picoctf.net)... 3.160.5.64, 3.160.5.40, 3.160.5.18, ...
Connecting to challenge-files.picoctf.net (challenge-files.picoctf.net)|3.160.5.64|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 7409664 (7.1M) [application/octet-stream]
Saving to: 'Windows_Logs.evtx'

Windows_Logs.evtx                                          100%[======================================================================================================================================>]   7.07M  1.82MB/s    in 3.9s    

2025-09-22 22:12:59 (1.82 MB/s) - 'Windows_Logs.evtx' saved [7409664/7409664]

AsianHacker-picoctf@webshell:~$ file Windows_Logs.evtx ‚å®Ô∏è
Windows_Logs.evtx: MS Windows Vista Event Log, 99 chunks (no. 98 in use), next record no. 8620
AsianHacker-picoctf@webshell:~$ cat Windows_Logs.evtx | head -n 10 ‚å®Ô∏è
ElfFileb!cNElfChnk__&r
'       zsh    NdwBi)M` :e W
%a^F=*Xa
        x&x*hSI]kMAAM
                     Eventjxmlns5http://schemas.microsoft.com/win/2004/08/events/eventjoTSystemAProviderF=KNameMicrosoft-Windows-Eventlog)Guid&{fc65ddd8-d6ef-4962-83d5-6e5cfe9ce148}AMaEventID'
ualifiers
         "N     Version
                       wdLevelE√©Task Opcode$KeywordsAP;
                                                       TimeCreated':j<√©
SystemTime
EventRecordID

A
 Correlation√ßF

ActivityID5RelatedActivityIDAm) ExecutionHFN

# Method 1: Windows (Double Click)
# Find: == (thinking base64) üëÄ
# Find: = (thinking base64) üëÄ

# Event Id: 1033
Windows Installer installed the product. Product Name: Totally_Legit_Software. Product Version: 1.3.3.7. Product Language: 0. Manufacturer: cGljb0NURntFdjNudF92aTN3djNyXw==üëÄ. Installation success or error status: 0.

# Event Id: 4657
A registry value was modified.

Subject:
	Security ID:		S-1-5-21-3576963320-1344788273-4164204335-1001
	Account Name:		user
	Account Domain:		DESKTOP-EKVR84B
	Logon ID:		0x5A428

Object:
	Object Name:		\REGISTRY\MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
	Object Value Name:	Immediate Shutdown (MXNfYV9wcjN0dHlfdXMzZnVsXw==üëÄ)
	Handle ID:		0x208
	Operation Type:		New registry value created

Process Information:
	Process ID:		0x1bd0
	Process Name:		C:\Program Files (x86)\Totally_Legit_Software\Totally_Legit_Software.exe

Change Information:
	Old Value Type:		-
	Old Value:		-
	New Value Type:		REG_SZ
	New Value:		C:\Program Files (x86)\Totally_Legit_Software\custom_shutdown.exe

# Event Id: 1074
The process C:\Windows\system32\shutdown.exe (DESKTOP-EKVR84B) has initiated the shutdown of computer DESKTOP-EKVR84B on behalf of user DESKTOP-EKVR84B\user for the following reason: No title for this reason could be found
 Reason Code: 0x800000ff
 Shutdown Type: shutdown
 Comment: dDAwbF84MWJhM2ZlOX0=üëÄ

https://cyberchef.io/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)&input=Y0dsamIwTlVSbnRGZGpOdWRGOTJhVE4zZGpOeVh3PT0KTVhOZllWOXdjak4wZEhsZmRYTXpablZzWHc9PQpkREF3YkY4NE1XSmhNMlpsT1gwPQ

picoCTF{Ev3nt_vi3wv3r_1s_a_pr3tty_us3ful_t00l_81ba3fe9} üîê
```

## Flag
picoCTF{Ev3nt_vi3wv3r_1s_a_pr3tty_us3ful_t00l_81ba3fe9}

## Continue
[Continue](./picoGym0432.md)